
# 8.5 CRUD 작업하기 
## 8.5.1 Create(생성)

컬렉션에 컬럼을 정의하지 않아도 된다.

- 아무 데이터나 넣을 수 있다. 
- 무엇이 들어올 지 모른다.

ObjectId는 고유한 값을 가지므로, MySQL에서 기본키로 쓰이는 값과 비슷한 역할을 한다. 

주로 다큐먼트 조회할 때 사용할 수 있다. 
<br>

```sql
db.users.save({name:'zero', age:24, married:false, comment: '안녕하세요', createdAt:new Date()});
```
db.컬렉션명.save(다큐먼트)

다큐먼트로는 원하는 요소만큼 자유롭게 데이터 타입과 데이터를 입력하여 넣어주면 된다.

성공적으로 수행되었을 경우: WriteResult({ "nInserted" : 1 })

<br/>

## 8.5.2 Read(조회)

다큐먼트 조회

<br>

```sql
db.users.find({}); // 모든 데이터 조회
```
db.컬렉션명.find(조회 시 필드에 줄 조건 설정, 조회할 필드)

1. 특정 필드만을 조회하되, 해당 필드들에 대해 조건은 따로 지정하지 않는다. 
( 문제 조건: name, married 필드만 조회하고자 한다. )
```sql
db.users.find({}, {_id:0, name:1, married:1}); 
```
- 0이나 false로 입력하면 해당 필드는 제외
- 1이나 true로 입력하면 해당 필드는 포함
- _id는 기본적으로 가져오는 필드인데, _id는 조회하고자 하지 않았기에 제외한다는 의미를 포함

2. 특정 필드만을 조회하되, 해당 필드들에 대해 조건도 지정해주도록 한다. (1)
( 문제 조건: age가 30 초과 이거나 married가 false인 경우를 만족하는 name, age 필드만 조회하고자 한다. )
```sql
db.users.find({age:  {$gt: 30}, married: true}, {_id:0, name:1, age:1}); 
```

- $gt : 초과 , greater than
- $gte: 이상 , greate than **equal to** 
- $lt : 미만 , less than
- $lte: 이하 , less than **equal to**
- $ne : 같지 않음 , not equal
- $eq : 같음 , equal
- $or : 또는 
- $in : 배열 요소 중 하나

3. 특정 필드만을 조회하되, 해당 필드들에 대해 조건도 지정해주도록 한다. (2)
( 문제 조건: age가 30 초과 이거나 married가 false인 경우를 만족하는 name, age 필드만 조회하고자 한다. )
```sql
db.users.find({ $or: [{age: { $gt: 30}}, {married: true}]}, {_id:0, name:1, age:1}); 
```

정렬하고자 할 때 **.sort(정렬의 기준이 되는 필드)**

- 내림차순: -1
- 오름차순: 1
```sql
db.users.find({}, {_id: 0, name:1, age:1}).sort({age:-1});
```

조회할 다큐먼트 개수 제한 **.limit(제한 개수)**
```sql
db.users.find({}, {_id: 0, name:1, age:1}).limit(1);
```

조회하면서 몇 개를 건너뛸지 설정 **.skip(1)**
```sql
db.users.find({}, {_id: 0, name:1, age:1}).skip(1);
```
<br/>

## 8.5.3 Update(수정)

기존 데이터 수정

<br>

```sql
db.users.update({name:'nero'}, {$set: {comment: '안녕하세요'}});
```
db.컬렉션명.update(수정할 다큐먼트 지정, 수정할 내용 입력)

$set : 어떤 필드를 수정할 지 정하는 연산자로, 그냥 일반 객체만 넣을 경우 다큐먼트가 통째로 두 번째 인수로 주어진 객체로 수정된다. 

<br/>


## 8.5.4 Delete(삭제)

데이터 삭제

<br>

```sql
db.users.remove({name: 'nero'});
```
db.컬렉션명.remove(삭제할 다큐먼트 지정)

<br/>

# 8.6 몽구스 사용하기 

몽고디비에 없어서 불편한 기능들을 몽구스가 보완해준다. 

- 스키마
- MySQL이 가지고 있는 JOIN 기능을 populate 메소드로 보완 가능 -> 관계형 데이터를 쉽게 가져올 수 있음
- 프로미스 문법과 강력하고 가독성이 높은 쿼리 빌더 지원
